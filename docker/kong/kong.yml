_format_version: "3.0"

services:
  - name: content-service
    url: http://host.docker.internal:3001
    routes:
      - name: content-pages
        paths:
          - /api/v1/pages
        strip_path: false
      - name: content-media
        paths:
          - /api/v1/media
        strip_path: false
      - name: content-templates
        paths:
          - /api/v1/templates
        strip_path: false
      - name: content-navigation
        paths:
          - /api/v1/navigation
        strip_path: false
      - name: content-redirects
        paths:
          - /api/v1/redirects
        strip_path: false
      - name: content-sitemap
        paths:
          - /api/v1/sitemap
        strip_path: false
      - name: content-seo
        paths:
          - /api/v1/seo
        strip_path: false
      - name: auth-routes
        paths:
          - /api/v1/auth
        strip_path: false

  - name: commerce-service
    url: http://host.docker.internal:3002
    routes:
      - name: commerce-products
        paths:
          - /api/v1/products
        strip_path: false
      - name: commerce-categories
        paths:
          - /api/v1/categories
        strip_path: false
      - name: commerce-cart
        paths:
          - /api/v1/cart
        strip_path: false
      - name: commerce-checkout
        paths:
          - /api/v1/checkout
        strip_path: false
      - name: commerce-orders
        paths:
          - /api/v1/orders
        strip_path: false
      - name: commerce-coupons
        paths:
          - /api/v1/coupons
        strip_path: false

  - name: integration-service
    url: http://host.docker.internal:3003
    routes:
      - name: integrations
        paths:
          - /api/v1/integrations
        strip_path: false
      - name: analytics
        paths:
          - /api/v1/analytics
        strip_path: false
      - name: webhooks
        paths:
          - /api/v1/webhooks
        strip_path: false

  - name: shipping-gateway
    url: http://host.docker.internal:3004
    routes:
      - name: shipping
        paths:
          - /api/v1/shipping
        strip_path: false

plugins:
  - name: cors
    config:
      origins:
        - "http://localhost:3100"
        - "http://localhost:3200"
        - "http://localhost:3300"
      methods:
        - GET
        - POST
        - PUT
        - DELETE
        - PATCH
        - OPTIONS
      headers:
        - Authorization
        - Content-Type
        - X-Request-ID
      exposed_headers:
        - X-Request-ID
      credentials: true
      max_age: 3600

  - name: rate-limiting
    config:
      minute: 300
      policy: local
      fault_tolerant: true
      hide_client_headers: false
